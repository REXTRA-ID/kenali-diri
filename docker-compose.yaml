services:
  db:
    image: postgres:14
    restart: always
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: kenali_diri
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7
    restart: always
    ports:
      - "6380:6379"

  api:
    build: .
    restart: always
    ports:
      - "8010:8000"
    depends_on:
      - db
      - redis
    volumes:
      - .:/app
    environment:
      # App Settings
      APP_NAME: "Kenali Diri API"
      APP_VERSION: "0.1.0"

      # Database & Cache
      DATABASE_URL: postgresql://user:password@db:5432/kenali_diri
      REDIS_URL: redis://redis:6379/0
      CELERY_BROKER_URL: redis://redis:6379/1

      # OpenRouter AI (replace with your actual key)
      OPENROUTER_API_KEY: ${OPENROUTER_API_KEY:-sk-or-v1-placeholder}
      OPENROUTER_BASE_URL: https://openrouter.ai/api/v1
      OPENROUTER_MODEL: google/gemini-3.0-flash

      # Security
      SECRET_KEY: ${SECRET_KEY:-your-super-secret-key-change-in-production}

volumes:
  postgres_data:
