"""Add MD4 Result changes

Revision ID: d364c74c43e5
Revises: c6f96ad1d8f8
Create Date: 2026-02-23 16:01:48.696194

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = 'd364c74c43e5'
down_revision: Union[str, Sequence[str], None] = 'c6f96ad1d8f8'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('career_recommendations', sa.Column('test_goal', sa.String(length=50), nullable=False, server_default=sa.text("'RECOMMENDATION'")))
    op.add_column('career_recommendations', sa.Column('top_profession1_id', sa.BigInteger(), nullable=True))
    op.add_column('career_recommendations', sa.Column('top_profession2_id', sa.BigInteger(), nullable=True))
    op.add_column('career_recommendations', sa.Column('created_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True))
    op.add_column('career_recommendations', sa.Column('ai_model_used', sa.String(length=50), nullable=True))
    op.drop_column('career_recommendations', 'generated_at')
    op.add_column('fit_check_results', sa.Column('created_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True))
    op.drop_column('fit_check_results', 'generated_at')
    op.add_column('ikigai_candidate_professions', sa.Column('total_candidates', sa.Integer(), nullable=False, server_default=sa.text('1')))
    op.add_column('ikigai_candidate_professions', sa.Column('generation_strategy', sa.String(length=50), nullable=True))
    op.add_column('ikigai_candidate_professions', sa.Column('max_candidates_limit', sa.Integer(), nullable=True))
    op.create_index('idx_ikigai_candidates_session', 'ikigai_candidate_professions', ['test_session_id'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index('idx_ikigai_candidates_session', table_name='ikigai_candidate_professions')
    op.drop_column('ikigai_candidate_professions', 'max_candidates_limit')
    op.drop_column('ikigai_candidate_professions', 'generation_strategy')
    op.drop_column('ikigai_candidate_professions', 'total_candidates')
    op.add_column('fit_check_results', sa.Column('generated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True))
    op.drop_column('fit_check_results', 'created_at')
    op.add_column('career_recommendations', sa.Column('generated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True))
    op.drop_column('career_recommendations', 'ai_model_used')
    op.drop_column('career_recommendations', 'created_at')
    op.drop_column('career_recommendations', 'top_profession2_id')
    op.drop_column('career_recommendations', 'top_profession1_id')
    op.drop_column('career_recommendations', 'test_goal')
    # ### end Alembic commands ###
